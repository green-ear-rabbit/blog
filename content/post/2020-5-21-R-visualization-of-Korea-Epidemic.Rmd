---
title: 'An exploration of patient infomation of COVID in South Korea'
author: "W"
date: "21/05/2020"
fontsize: 13pt
output: pdf_document
link-citations: yes
mainfont: Palatino
bibliography: "reference/a1.bib"
subtitle: A brief visualization in R
biblio-style: apalike
always_allow_html: true
tags: ["Korea", "COVID-19", "Visualization"]
---
```{r include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

```{r}
require(tidyverse)
require(ggplot2)
```

# Overview of assignment requirement
VisualizationofdataingraphicalformatusingR.Submission deadline: 2020-03-23 14:00 (5% of final mark, no re-sit) 

 - Obtain a public health dataset (different from Assignment 1, from published papers, government websites, or your own research) that is suitable for producing graphs.
 - Import the dataset into an R project in an R markdown report.
 - Plot three of the following graphs with the dataset in the report:scatterplot, pie chart, bar graph, and box graph. For the scatter plot, please provide a linear regression, list the intercept, slope, and the correlation coeï¬€icient using R. For the box graph, please add the mean value to each box. 
 - Knit the .Rmd file into a .pdf report.
 - Submit the data file, the R markdown file (.Rmd), the report file (.pdf), and the project file (.Rproj).
 
 
# My research topic 
COVID-19 has rapidly become a worldwide pandemic since December in 2019, with the symtoms of fever, cough, fatigue, and clinic manifestation of maniground-glass lung changes, hypoxaemia, and deranged gastrointestinal, liver and renal function[@chan_familial_2020]. For severe cases, the disease will deteriorate to severe fibrotic lung (which is called "Withe Lung" by Chinese doctors), and multi-organ failure [@cao_trial_2020].

Moreover, the virus has a high reproductive number (R~0~). Due to the R~0~ and be influenced by multi-factors including population density and temporal policy or laws, there is no extract and  international consensus R~0~ published. But up to know, we can see that at early stage of transmission, R~0~ is around 3.6~4.0[@read_novel_2020], which is higher than seasonal flu (~1.2) and swine flu (~1.2-1.6)[@read_novel_2020].

Due to the rapid transimission of disease and relatively high fatality, it has become a emergency problem worldwide. Some early infected countries e.g., Japan and South Korea, have published open datasets to researches worldwide.  

KCDC (Korea Centers for Disease Control & Prevention) announces that the information of COVID-19 quickly and transparently, and published a dataset for annoymous patient infomation. They also published some most simple and basic visulization of sociodemographic characteristic of patients, simple bars and simple pies. However, the visualization is deficient, less informed and less artistic. Click [here](https://www.kaggle.com/kimjihoo/coronavirusdataset) to download the whole dataset published on by KCDC.

This brief report will provide more informed and artistic visuliation and analysis than availiable results on [Kaggle](https://www.kaggle.com) to download the whole dataset. Given the current condition in Korea, we mainly focus on three research questions:

 - Is there any relationship between age and the number of contacted people from infection to isolated?
 - Is there any cluster transmission of disease, e.g.,religious group, as [news]("https://www.bbc.com/news/world-asia-51603251") reported. 
 - How is the cases distributed in each province?
# Create a R project and input data
I created a R project floder and a .Rproj file in it. Moreover, it has been connected to github, however, according to the university policy, this repositary in github will not be available in public until the submission deadline. 

 - Floder name: DPH206_A2
 - R project name: DPH206_A2.Rproj
 - Github repositary name: Wanqi-Wang/DPH206_A2

```{r}
ds<-readr::read_csv("data/patientinfo.csv")
```

```{r}
dim(ds)
```
The dataset has 2218 rows (objectives) and 18 columns (variables). To save computing time, **Table 1** Provide a brief look at the first ten rows of the dataset. 
```{r}
DT::datatable(ds[c(1:10),],caption = "Table 1. A brief look at first 10 rows of the dataset of COVID outbreak in South Korea")
```


# RQ1: Is there any relationship between age and the number of contacted people from infection to isolation
The reason of why did I interest in this research question is that, previous studies shown that people with younger or middle age may have more contact with others. Moreover, people in such age are realtively strong and more likely to work or continue daily activity after some mild symtoms onset. Following analysis will analyze that if younger people has more contacted people from infection to isolation.

 - The "age" variable in dataset are rounded to numbers like "30s", "40s", I think we might lose information for this rounded age, so let's calculate the accurate age by birth year of participants
```{r}
str(ds$birth_year)
ds$trueage<-2020-ds$birth_year
range(ds$trueage, na.rm = TRUE)
ds$agegroup=cut(ds$trueage, breaks = seq(0,110, by = 10), right = FALSE,labels = c("0-10","10-20","20-30","30-40","40-50","50-60","60-70","70-80",">80",">80", ">80"))
```

 - The "contact_number" means the number of people this person had contaced from infected to isolated. There is 1807 of them whose contact number is unknown, but we still have 411 observations.
```{r}
summary(ds$contact_number, na.rm=TRUE)
range(ds$contact_number, na.rm = TRUE)
```

 - Create a analysis sample for RQ1.
```{r}
dst<-subset(ds,!is.na(ds$contact_number)& !is.na(ds$trueage))
```

 - Make a pilot visuliation to see if there is any relationship between age and contacted number
```{r}
lm1<-lm(dst$contact_number~dst$trueage)
sqrt(summary(lm1)$r.squared)
plot(dst$trueage, dst$contact_number, pch = 16, 
     col=ifelse(dst$contact_number > mean(dst$contact_number),ifelse(dst$contact_number>mean(dst$contact_number)+2*sd(dst$contact_number),"red","yellow"), "green"), xlim = c(0, 120), ylim = c(0, 1200), xlab = "Age of participants", ylab = "contact number from infected to isolated", main= "Figure 1: Distribution of contacted number across age", sub = "Note: Analysis sample N=322",las = 1) 
abline(h = mean(dst$contact_number)+2*sd(dst$contact_number), col="red") 
abline(h = mean(dst$contact_number), col="blue")
abline(lm1,col="black")
text(80,mean(dst$contact_number)+ 40, labels = "mean of contact number")
text(20,50, labels = "y=25.12-0.02x, r=0.0035")
text(80,mean(dst$contact_number)+2*sd(dst$contact_number)+40, labels = "mean+2SD of contact number")
text(x=dst$trueage, y=dst$contact_number+ 40, labels=ifelse(dst$contact_number>mean(dst$contact_number)+2*sd(dst$contact_number),dst$contact_number,""), col="red") 
```

As you see, in this scatter plot, some points are higher than mean+2SD. Moverover, due to the large y limit of plot, we cannot clearly distinguish liner regression line and the horizontal line of mean. Thereby, I would remove "extreme point" and plot again, however, definately we cannot remove "extreme point" by the point higher than mean+2SD, becasue the contacted number, this variable, may not be normally distributed. Let's test it!

 - Produce a curve to see if the contacted number of patients are normally distributed.
```{r}
library("ggpubr")
ggdensity(dst$contact_number, 
          main = "Figure 2: Density plot of contact_number of patients",
          xlab = "Number of contacted people from infection to isolation")
```
Clearly shown in **Figure 2**, it's not a normal distribution. So we cannot pick up outliers by traditional statistical methods used in normal distribution. Let's use boxplot! A boxplot was used to detect outliers and display heterogeneity of distribution and effects of explanatory variables. 

 - Let's make a boxplot for each age group, to detect outliers of contacted number
```{r}
boxplot(dst$contact_number~dst$agegroup,
main="Figure 3: Boxplots of contacted number across age group",
sub = "Analysis sample N=322",
xlab="Age group",
ylab="Note: Number of contacted people from infection to isolation",
col=rainbow(9),
border="brown"
)
```

Let's create a better boxplot
```{r}
boxplot(dst$contact_number~dst$agegroup,
main="Figure 4: Contacted number across age group (outliner removed)",
sub = "Note: Analysis sample N=253",
xlab="Age group",
ylab="Number of contacted people from infection to isolation",
col=rainbow(9),
border="brown", outline=FALSE
)
outliers <- boxplot(dst$contact_number~dst$agegroup, plot=FALSE)$out
means <- by(dst[-which(dst$contact_number %in% outliers),]$contact_number, dst[-which(dst$contact_number %in% outliers),]$agegroup, mean) 
points(means, col = 'black', pch = 17)
```

 - Let's exclude outliers and re-plot a scatter plot and its linear trend.
```{r}
dst2<-dst[-which(dst$contact_number %in% outliers),]
range(dst2$contact_number)
```

```{r}
lm2<-lm(dst2$contact_number~dst2$trueage)
sqrt(summary(lm2)$r.squared)

plot(dst2$trueage, dst2$contact_number, pch = 16, col = "green", xlim = c(0, 110), ylim = c(0, 70), xlab = 'Age of participants', ylab = 'Contact number from infected to isolated', main = "Figure 5: Distribution of contacted number across age (outliers excluded)", sub = "Note: Analysis sample N=253", las = 1) 
abline(lm2, col="black") 
text(90, 12,"y=8.00-0.02x, r=0.057")
```


 - Produce a quantile-quantile plot of the residuals to test for the normality of residuals
```{r}
dst2$RESID <- resid(lm2)
qq <- ggplot(dst2, aes(sample=RESID)) +
    stat_qq() +
    stat_qq_line() +
    ggtitle("Figure 6: Quantile-quantile plot of residuals")
qq
```
Accoding to the qqplot shown in **Figure 6**, personally feeling, the residuals are mainly normally distributed. Thereby, I assume that a simple linaer regression is acceptable.


# RQ2: Is there any cluster transmission of disease, e.g.,religious group?

```{r}
dsp <- ds %>% 
     mutate_at("infection_case", funs(recode(., "Shincheonji Church"= "Church","Onchun Church"= "Church", "River of Grace Community Church" = "Church","Dongan Church"="Church","gym facility in Sejong"="Gym facility", "gym facility in Cheonan"="Gym facility", "Suyeong-gu Kindergarten"="Apartment & Kindergardem", "Seongdong-gu APT"="Apartment & Kindergardem", "Cheongdo Daenam Hospital"="Hospital & Government agency", "Eunpyeong St. Mary's Hospital"="Hospital & Government agency", "Guro-gu Call Center"="Hospital & Government agency", "Ministry of Oceans and Fisheries"="Hospital & Government agency", "Pilgrimage to Israel"="Else", 
     "etc" ="Else","contact with patient"="Contact with patient", "NA" ="Unknown")))
dsp$inf<-as.factor(dsp$infection_case)
```

```{r}
library("plotrix")
te<-summary(dsp$inf[!is.na(dsp$inf)])
f3<-pie3D(te,explode=0.05, col=rainbow(7),main = "Figure 7: Pie chart the distribution of suspected infection source (missing value excluded)")
pie3D.labels(f3,labels=names(te),labelrad=1.8)
```

 - Plot a bar graph for each age group
```{r}
barplot(summary(dsp$inf[!is.na(dsp$inf)]), col=rainbow(7),main = "Figure 8: Bar graph the distribution of suspected infection source (missing value excluded)")
```

Let's explore if there is some difference for different gender
```{r}
table1<-table(dsp$sex,dsp$inf)
barplot(table1, main="Figure 9: The bar plot for suspected infection source for different age group",
  xlab="suspected infection source",ylab="Number of patients", col=c("pink","blue"),
  legend = rownames(table1), beside=TRUE)
```


# RQ3: How is the cases distributed in each province?
A bar plot was maded to compare cases across different province, as shown in **Figure 3**.
```{r}
ds$pro<-as.factor(ds$province)
summary(ds$pro)
barplot(summary(ds$pro), col = rainbow(12), ylim = c(0, 1150), xlab = 'Province', ylab = 'Confirmed cases of COVID', main = "Figure 10: the distribution of COVID cases across South Korea", density=10,las = 1)
```

# Results
As for research question 1, **Figure 1** provide a pilot visulation of age and contacted number, and then I plan to exclude the outliers of contacted number. But we need to see if the contacted number is normal distributed. As shown in **Figure 2**, it's not a normal distributed. Then I switch age to age group, then make a boxplot and exclude outliers in each age group, as shown in **Figure 3** & **Figure 4**. Later we make a new scatter plot to exclude outliers of each age group (**Figure 5**). Moreover, the normality of linear regression was tested by a quantile-quantile plot (**Figure 6**). From the visulation, we can see that the overall trend is that, by the increasing age, the contacted number of people from infection to isolation is decresed, even if for children and teenagers may be lower from the visualtion. For every one unit increase in age, the number of contacted will decrease 0.02 unit, correlation coefficient is 0.05680231, which is much more better then the model which include outliers (y=25.12-0.02x, r=0.0035). Thereby, yound adults are at a relatively high risk to spread disease, and the suspension of bussness, fatories and colleges is necessary for the infection control. The statistical methods are according to statistical textbook [@van_belle_biostatistics_2004]


As for research question 2, to visualize the suspected infection source, I first plot a pie chart (**Figure 7**) to see the percentage, but due to the inherited limition of pie chart, which is potential missleading. Thereby, we plot a bar graph (**Figure 8**), we can see that contact with patients takes most of cases, which is consistant with previous research of high R~0~. The hospital and government agency also takes large count, which indicates that the nosocomial infection of COVID contributes to the outbreak of COVID in South Korea, and the disease control in government agency make be suboptimal. Moreover, we make a multiple bar plot for male and female (**Figure 9**), there are 34 female infected by gym facility, while no male reported to be infected at gym facility, which may be considered as a cluster infection in gym facility.


At last, I made **Figure 10** and find that Gyeongsangbuk-do has the most infected cases (n=1054), which is consistant with previous [news](http://www.korea.net/NewsFocus/Society/view?articleId=182693). The government may need to send professional medical and disease control team to Gyeongsangbuk-do, and provide more funding to the province for disease control.

# Conclusion 
It's only an pilot study, several study limitations merit noting. **First**, due to limited varaibles for travel history, co-morbidities, and symtoms, our analysis is relatively weak. **Second**, the generality is limited due to different policy and laws for disease control, different life and diety style between Korea and other counties. 

Nevertheless, the report is an exploratory try of Korea COVID outbreak dataset, and a clear clue were tried to designed, rather than just make many plots. Both idea and code are finished independently. All relative online source are provided with a link, and all realtive research are provided citation and link-citation reference list. 

# References 

